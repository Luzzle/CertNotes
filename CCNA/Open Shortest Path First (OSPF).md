#IPConnectivity #ccna-day24 #ccna-day26 #ccna-day27

### Overview
**Metric** - Cost
The cost of each link is calculated based on bandwidth. The total metric is the total cost of each link in the route.

Uses Dijkstra's Algorithm to determine the shortest path to destination.

[[OSPF Network Types]]
### Cost
Calculated based on the bandwidth (speed) of the interface.
- Reference Bandwidth / Interface Bandwidth
- Default bandwidth is 100 mbps
- Minimum cost of 1

```ios
(config-router)# auto-cost reference-bandwidth megabits-per-second
```

You should configure a reference bandwidth greater than the fastest links in your network.

OSPF uses the following criteria to select the router ID:
1. Manual configuration of the router ID.
2. Highest IP address on a loopback interface.
3. Highest IP address on a non-loopback interface.

Default Hello Timer: 10 seconds

**The OSPF cost to a destination is the total cost of the exit interfaces. (Loopback interfaces have a cost of 1)**
### LSAs and LSDBs
Routers store information about the network in LSA's (Link State Advertisements) which are organized in a structure called LSDB (Link State Database).
Routers will flood LSA's until all routers in the OSPF area develop the same map of the network.
###### LSA Flooding
A router will create a LSA to tell its neighbors about networks attached to itself. The LSA is flooded throughout the network until all routers have received it.

This results in all routers sharing the same LSDB.
#### LSA Types
**Type 1 (Router LSA)**
- Generated by every router
- Identifies the router by RID and lists all networks attached to the routers OSPF enabled interfaces.

**Type 2 (Network LSA)**
- Generated by the DR of each 'multi-access' network (i.e. [[OSPF Network Types#Broadcast|Broadcast]] network type).
- Lists the routers attached to the multi-access network.

**Type 3 (Inter-Area LSA)**
- ABR Summaries
### OSPF Areas
OSPF uses **areas** to divide up a network.

Larger networks can have performance issues if they are single area.
- more time to calculate routes, needing exponentially more time.
- takes up more memory on the routers
- any small change causes every router to flood LSAs and run the SPF algorithm again.

The backbone area (area 0) is an area that all other areas must connect to.
Routers with all interfaces in the same area are called **internal routers**, whilst others in multiple areas are called **Area Border Routers (ARBs)**
###### ARBs
- ARBs maintain a separate LSDB for each area they are connected to. Each ARB should be connected to at most 2 areas.

An **intra-area** route is a route to a destination inside the same OSPF area.
An **inter-area** route  is a route to a different OSPF area.

### Configuration
```ios
(config)# router ospf [Process ID] -- Process ID is locally significant
(config-router)# network [network address] [wildcard subnet] area [num]
```

An **autonomous system boundary router** is an OSPF router that connects the OSPF network to an external network.

##### Bandwidth Command
The bandwidth command changes the value used to calculate different metrics on an interface, not the speed at which the interface operates.

It is recommended you use **ip ospf cost** on an interface instead of the interface command as it affects other calculations not just for OSPF.

### OSPF Neighbors
When OSPF is activated on an interface, the router starts sending **hello** messages out of the interface at regular intervals. Hello messages are multicast to 224.0.0.5.

#### Neighbor Requirements
1) Area number must match
2) Interfaces must be in the same subnet
3) OSPF process must not be shutdown
4) OSPF RID's must be unique
5) Hello and Dead timers must match

The next should match as OSPF will not function correctly if they do not.
1) Authentication settings must match
2) IP MTU settings must match


#### Neighbor States
##### Down State
OSPF is activated to an interface, it sends a hello message to 224.0.0.5

##### Init State
When R2 receives a hello packet from R1 it adds R1 to its neighbor table. Its received a hello packet, but its own router id is in the hello packet.

##### 2-way State
The two routers will then prepare to exchange information about their LSDB.
They have to decide who will start the exchange.

##### Exstart State
The router with the higher RID will become the master, the router with the lower RID will become the slave.

To decide the Master and Slave, they exchange DBD packets.

##### Exchange State
The routers exchange DBDs which contain a list of LSA's in their LSDB. 
These DBDs do not include detailed information about the LSAs, just basic information.
The routers compare information from the DBD to their own LSDB to determine what LSA's they must receive.

##### Loading State
![[Pasted image 20250428163355.png]]

##### Full State
In the full state the routers have identical LSDBs. They will continue to regularly send hello packets to maintain neighbor adjacency.

Every time a hello packet is received, the dead timer is reset. If the dead timer reaches 0 and no hello message is received, the neighbor is removed.

The routers will continue to share LSAs as the network changes to make sure each router has a complete and accurate map of the network.


